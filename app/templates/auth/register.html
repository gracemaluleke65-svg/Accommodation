{% extends "base.html" %}

{% block title %}Register - UniStay{% endblock %}

{% block page_css %}
<style>
  /* REGISTRATION PAGE SPECIFIC STYLES */
  
  :root {
    --form-bg: #FFFFFF;
    --input-border: #E2E8F0;
    --input-focus: #4299E1;
    --form-shadow: 0 10px 40px rgba(0, 0, 0, 0.08);
    --form-radius: 16px;
    --gradient-primary: linear-gradient(135deg, #FF6F00 0%, #FF8F00 100%);
    --gradient-secondary: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
  }
  
  .registration-container {
    min-height: calc(100vh - 200px);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem 0;
    background: linear-gradient(135deg, #fdf6e3 0%, #f5f7fa 100%);
    position: relative;
    overflow: hidden;
  }
  
  .registration-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--gradient-primary);
  }
  
  .registration-card {
    background: var(--form-bg);
    border-radius: var(--form-radius);
    box-shadow: var(--form-shadow);
    border: none;
    overflow: hidden;
    position: relative;
    z-index: 1;
    transition: transform 0.3s ease;
  }
  
  .registration-card:hover {
    transform: translateY(-5px);
  }
  
  .registration-header {
    background: var(--gradient-primary);
    color: white;
    padding: 2.5rem 2rem;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  
  .registration-header::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
    background-size: 30px 30px;
    animation: float 20s linear infinite;
  }
  
  .registration-title {
    font-family: 'Montserrat', sans-serif;
    font-weight: 700;
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
    position: relative;
    z-index: 1;
  }
  
  .registration-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
    position: relative;
    z-index: 1;
  }
  
  .registration-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    animation: bounce 2s infinite;
    position: relative;
    z-index: 1;
  }
  
  .registration-form {
    padding: 2.5rem;
  }
  
  .form-group {
    margin-bottom: 1.5rem;
  }
  
  .form-label {
    font-weight: 600;
    color: var(--secondary);
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
  }
  
  .form-label i {
    margin-right: 0.5rem;
    color: var(--primary);
  }
  
  .form-control {
    padding: 0.75rem 1rem;
    border: 2px solid var(--input-border);
    border-radius: 10px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: #F8FAFC;
  }
  
  .form-control:focus {
    border-color: var(--input-focus);
    box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
    background: white;
  }
  
  .form-control::placeholder {
    color: #A0AEC0;
  }
  
  .input-with-icon {
    position: relative;
  }
  
  .input-with-icon .form-control {
    padding-left: 3rem;
  }
  
  .input-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: #A0AEC0;
    z-index: 2;
  }
  
  .password-strength {
    height: 4px;
    background: #E2E8F0;
    border-radius: 2px;
    margin-top: 0.5rem;
    overflow: hidden;
  }
  
  .strength-meter {
    height: 100%;
    width: 0;
    border-radius: 2px;
    transition: all 0.3s ease;
  }
  
  .strength-weak { background: #EF4444; }
  .strength-fair { background: #F59E0B; }
  .strength-good { background: #10B981; }
  .strength-strong { background: #059669; }
  
  .password-hint {
    font-size: 0.85rem;
    color: #718096;
    margin-top: 0.5rem;
  }
  
  .profile-preview {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
    border: 4px solid white;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    display: none;
    margin: 1rem auto;
  }
  
  .file-upload-area {
    border: 2px dashed #CBD5E0;
    border-radius: 10px;
    padding: 2rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: #F8FAFC;
  }
  
  .file-upload-area:hover {
    border-color: var(--primary);
    background: #EDF2F7;
  }
  
  .file-upload-area.dragover {
    border-color: var(--primary);
    background: #EBF8FF;
  }
  
  .register-btn {
    background: var(--gradient-primary);
    border: none;
    padding: 1rem;
    font-size: 1.1rem;
    font-weight: 600;
    border-radius: 12px;
    color: white;
    width: 100%;
    transition: all 0.3s ease;
    margin-top: 1rem;
  }
  
  .register-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(255, 111, 0, 0.3);
  }
  
  .register-btn:active {
    transform: translateY(0);
  }
  
  .login-link {
    text-align: center;
    margin-top: 2rem;
    color: #718096;
  }
  
  .login-link a {
    color: var(--primary);
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s ease;
  }
  
  .login-link a:hover {
    text-decoration: underline;
  }
  
  .benefits-list {
    background: #F0F9FF;
    border-radius: 12px;
    padding: 1.5rem;
    margin-top: 2rem;
  }
  
  .benefits-list h6 {
    color: var(--primary);
    margin-bottom: 1rem;
    font-weight: 600;
  }
  
  .benefit-item {
    display: flex;
    align-items: center;
    margin-bottom: 0.75rem;
  }
  
  .benefit-item i {
    color: var(--primary);
    margin-right: 0.75rem;
    font-size: 0.9rem;
  }
  
  /* Form Validation Styles */
  .is-invalid {
    border-color: #EF4444 !important;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23EF4444'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath stroke-linejoin='round' d='M5.8 3.6h.4L6 6.5z'/%3e%3ccircle cx='6' cy='8.2' r='.6' fill='%23EF4444' stroke='none'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right calc(0.375em + 0.1875rem) center;
    background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
  }
  
  .is-valid {
    border-color: #10B981 !important;
  }
  
  .invalid-feedback {
    display: block;
    width: 100%;
    margin-top: 0.25rem;
    font-size: 0.875em;
    color: #EF4444;
  }
  
  /* Animations */
  @keyframes float {
    0% { transform: translate(0, 0) rotate(0deg); }
    100% { transform: translate(-30px, -30px) rotate(360deg); }
  }
  
  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }
  
  @keyframes slideIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  .form-row > div {
    animation: slideIn 0.5s ease forwards;
    opacity: 0;
  }
  
  .form-row > div:nth-child(1) { animation-delay: 0.1s; }
  .form-row > div:nth-child(2) { animation-delay: 0.2s; }
  .form-row > div:nth-child(3) { animation-delay: 0.3s; }
  .form-row > div:nth-child(4) { animation-delay: 0.4s; }
  .form-row > div:nth-child(5) { animation-delay: 0.5s; }
  .form-row > div:nth-child(6) { animation-delay: 0.6s; }
  
  /* Responsive Design */
  @media (max-width: 768px) {
    .registration-container {
      padding: 1rem;
    }
    
    .registration-title {
      font-size: 2rem;
    }
    
    .registration-form {
      padding: 1.5rem;
    }
    
    .form-row {
      flex-direction: column;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="registration-container">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-10 col-xl-8">
        <div class="registration-card">
          <!-- Header with Gradient -->
          <div class="registration-header">
            <div class="registration-icon">
              <i class="fas fa-user-plus"></i>
            </div>
            <h1 class="registration-title">Join UniStay Family</h1>
            <p class="registration-subtitle">Find your perfect student accommodation in just a few steps</p>
          </div>
          
          <!-- Registration Form -->
          <div class="registration-form">
            <form method="POST" enctype="multipart/form-data" id="registrationForm" novalidate>
              {{ form.hidden_tag() }}
              
              <div class="row form-row g-4">
                <!-- Student Number -->
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="form-label" for="{{ form.student_number.id }}">
                      <i class="fas fa-id-card"></i> Student Number
                    </label>
                    <div class="input-with-icon">
                      <i class="fas fa-graduation-cap input-icon"></i>
                      {{ form.student_number(class="form-control", placeholder="Enter 8-digit student number", id=form.student_number.id) }}
                    </div>
                    {% if form.student_number.errors %}
                    <div class="invalid-feedback">
                      {% for error in form.student_number.errors %}
                      <span>{{ error }}</span>
                      {% endfor %}
                    </div>
                    {% endif %}
                  </div>
                </div>
                
                <!-- Full Name -->
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="form-label" for="{{ form.full_name.id }}">
                      <i class="fas fa-user"></i> Full Name
                    </label>
                    <div class="input-with-icon">
                      <i class="fas fa-user-circle input-icon"></i>
                      {{ form.full_name(class="form-control", placeholder="Enter your full name", id=form.full_name.id) }}
                    </div>
                    {% if form.full_name.errors %}
                    <div class="invalid-feedback">
                      {% for error in form.full_name.errors %}
                      <span>{{ error }}</span>
                      {% endfor %}
                    </div>
                    {% endif %}
                  </div>
                </div>
                
                <!-- Email Address -->
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="form-label" for="{{ form.email.id }}">
                      <i class="fas fa-envelope"></i> Email Address
                    </label>
                    <div class="input-with-icon">
                      <i class="fas fa-at input-icon"></i>
                      {{ form.email(class="form-control", placeholder="your.email@student.com", type="email", id=form.email.id) }}
                    </div>
                    {% if form.email.errors %}
                    <div class="invalid-feedback">
                      {% for error in form.email.errors %}
                      <span>{{ error }}</span>
                      {% endfor %}
                    </div>
                    {% endif %}
                  </div>
                </div>
                
                <!-- Phone Number -->
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="form-label" for="{{ form.phone_number.id }}">
                      <i class="fas fa-phone"></i> Phone Number
                    </label>
                    <div class="input-with-icon">
                      <i class="fas fa-mobile-alt input-icon"></i>
                      {{ form.phone_number(class="form-control", placeholder="07X XXX XXXX", id=form.phone_number.id) }}
                    </div>
                    {% if form.phone_number.errors %}
                    <div class="invalid-feedback">
                      {% for error in form.phone_number.errors %}
                      <span>{{ error }}</span>
                      {% endfor %}
                    </div>
                    {% endif %}
                  </div>
                </div>
                
                <!-- ID Number -->
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="form-label" for="{{ form.id_number.id }}">
                      <i class="fas fa-fingerprint"></i> ID Number
                    </label>
                    <div class="input-with-icon">
                      <i class="fas fa-id-badge input-icon"></i>
                      {{ form.id_number(class="form-control", placeholder="13-digit ID number", id=form.id_number.id) }}
                    </div>
                    {% if form.id_number.errors %}
                    <div class="invalid-feedback">
                      {% for error in form.id_number.errors %}
                      <span>{{ error }}</span>
                      {% endfor %}
                    </div>
                    {% endif %}
                  </div>
                </div>
                
                <!-- Profile Picture -->
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="form-label" for="{{ form.profile_picture.id }}">
                      <i class="fas fa-camera"></i> Profile Picture
                    </label>
                    <div class="file-upload-area" id="fileUploadArea">
                      <i class="fas fa-cloud-upload-alt fa-2x text-primary mb-3"></i>
                      <p class="mb-2">Drag & drop your photo or <span class="text-primary">browse</span></p>
                      <small class="text-muted">Supports: JPG, PNG, GIF (Max 5MB)</small>
                      {{ form.profile_picture(class="d-none", id=form.profile_picture.id, accept="image/*") }}
                    </div>
                    <img id="profilePreview" class="profile-preview" src="" alt="Profile Preview">
                    {% if form.profile_picture.errors %}
                    <div class="invalid-feedback">
                      {% for error in form.profile_picture.errors %}
                      <span>{{ error }}</span>
                      {% endfor %}
                    </div>
                    {% endif %}
                  </div>
                </div>
                
                <!-- Password -->
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="form-label" for="{{ form.password.id }}">
                      <i class="fas fa-lock"></i> Password
                    </label>
                    <div class="input-with-icon">
                      <i class="fas fa-key input-icon"></i>
                      {{ form.password(class="form-control", placeholder="Create a strong password", id=form.password.id, onkeyup="checkPasswordStrength(this.value)") }}
                    </div>
                    <div class="password-strength">
                      <div class="strength-meter" id="passwordStrength"></div>
                    </div>
                    <div class="password-hint" id="passwordHint">
                      Use 8+ characters with letters, numbers & symbols
                    </div>
                    {% if form.password.errors %}
                    <div class="invalid-feedback">
                      {% for error in form.password.errors %}
                      <span>{{ error }}</span>
                      {% endfor %}
                    </div>
                    {% endif %}
                  </div>
                </div>
                
                <!-- Confirm Password -->
                <div class="col-md-6">
                  <div class="form-group">
                    <label class="form-label" for="{{ form.confirm_password.id }}">
                      <i class="fas fa-lock"></i> Confirm Password
                    </label>
                    <div class="input-with-icon">
                      <i class="fas fa-redo input-icon"></i>
                      {{ form.confirm_password(class="form-control", placeholder="Re-enter your password", id=form.confirm_password.id, onkeyup="checkPasswordMatch()") }}
                    </div>
                    <div id="passwordMatch" class="password-hint"></div>
                    {% if form.confirm_password.errors %}
                    <div class="invalid-feedback">
                      {% for error in form.confirm_password.errors %}
                      <span>{{ error }}</span>
                      {% endfor %}
                    </div>
                    {% endif %}
                  </div>
                </div>
              </div>
              
              <!-- Registration Benefits -->
              <div class="benefits-list">
                <h6><i class="fas fa-gift me-2"></i> Benefits of Joining UniStay:</h6>
                <div class="benefit-item">
                  <i class="fas fa-check-circle"></i>
                  <span>Access to premium student accommodations</span>
                </div>
                <div class="benefit-item">
                  <i class="fas fa-check-circle"></i>
                  <span>Secure online payments & booking system</span>
                </div>
                <div class="benefit-item">
                  <i class="fas fa-check-circle"></i>
                  <span>24/7 customer support for students</span>
                </div>
                <div class="benefit-item">
                  <i class="fas fa-check-circle"></i>
                  <span>NSFAS & bursary payment integration</span>
                </div>
              </div>
              
              <!-- Submit Button -->
              <button type="submit" class="register-btn" id="submitBtn">
                <i class="fas fa-user-plus me-2"></i> Create Account
              </button>
              
              <!-- Login Link -->
              <div class="login-link">
                <p>Already have an account? <a href="{{ url_for('auth.login') }}">Sign in here</a></p>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Password strength checker
  function checkPasswordStrength(password) {
    const strengthBar = document.getElementById('passwordStrength');
    const hint = document.getElementById('passwordHint');
    let strength = 0;
    
    // Check password criteria
    if (password.length >= 8) strength++;
    if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength++;
    if (password.match(/\d/)) strength++;
    if (password.match(/[^a-zA-Z\d]/)) strength++;
    
    // Update strength bar
    strengthBar.className = 'strength-meter';
    strengthBar.style.width = (strength * 25) + '%';
    
    // Update hint text
    if (password.length === 0) {
      hint.textContent = 'Use 8+ characters with letters, numbers & symbols';
      hint.style.color = '#718096';
    } else {
      switch(strength) {
        case 0:
        case 1:
          strengthBar.classList.add('strength-weak');
          hint.textContent = 'Password is weak';
          hint.style.color = '#EF4444';
          break;
        case 2:
          strengthBar.classList.add('strength-fair');
          hint.textContent = 'Password is fair';
          hint.style.color = '#F59E0B';
          break;
        case 3:
          strengthBar.classList.add('strength-good');
          hint.textContent = 'Password is good';
          hint.style.color = '#10B981';
          break;
        case 4:
          strengthBar.classList.add('strength-strong');
          hint.textContent = 'Password is strong!';
          hint.style.color = '#059669';
          break;
      }
    }
  }
  
  // Password match checker
  function checkPasswordMatch() {
    const password = document.getElementById('{{ form.password.id }}').value;
    const confirmPassword = document.getElementById('{{ form.confirm_password.id }}').value;
    const matchDiv = document.getElementById('passwordMatch');
    
    if (confirmPassword.length === 0) {
      matchDiv.textContent = '';
    } else if (password === confirmPassword) {
      matchDiv.innerHTML = '<i class="fas fa-check-circle text-success me-1"></i> Passwords match';
      matchDiv.style.color = '#10B981';
    } else {
      matchDiv.innerHTML = '<i class="fas fa-times-circle text-danger me-1"></i> Passwords do not match';
      matchDiv.style.color = '#EF4444';
    }
  }
  
  // Profile picture preview
  document.addEventListener('DOMContentLoaded', function() {
    const fileInput = document.getElementById('{{ form.profile_picture.id }}');
    const fileUploadArea = document.getElementById('fileUploadArea');
    const preview = document.getElementById('profilePreview');
    
    // Click on area triggers file input
    fileUploadArea.addEventListener('click', () => fileInput.click());
    
    // Drag and drop events
    fileUploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      fileUploadArea.classList.add('dragover');
    });
    
    fileUploadArea.addEventListener('dragleave', () => {
      fileUploadArea.classList.remove('dragover');
    });
    
    fileUploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      fileUploadArea.classList.remove('dragover');
      if (e.dataTransfer.files.length) {
        fileInput.files = e.dataTransfer.files;
        showPreview(e.dataTransfer.files[0]);
      }
    });
    
    // File selection via input
    fileInput.addEventListener('change', function() {
      if (this.files && this.files[0]) {
        showPreview(this.files[0]);
      }
    });
    
    function showPreview(file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        preview.src = e.target.result;
        preview.style.display = 'block';
        fileUploadArea.style.display = 'none';
      };
      reader.readAsDataURL(file);
    }
    
    // Form validation
    const form = document.getElementById('registrationForm');
    form.addEventListener('submit', function(e) {
      const password = document.getElementById('{{ form.password.id }}').value;
      const confirmPassword = document.getElementById('{{ form.confirm_password.id }}').value;
      
      if (password !== confirmPassword) {
        e.preventDefault();
        alert('Passwords do not match!');
        return false;
      }
    });
    
    // Real-time validation
    const inputs = form.querySelectorAll('.form-control');
    inputs.forEach(input => {
      input.addEventListener('blur', function() {
        if (!this.value) {
          this.classList.remove('is-valid', 'is-invalid');
        } else if (this.checkValidity()) {
          this.classList.remove('is-invalid');
          this.classList.add('is-valid');
        } else {
          this.classList.remove('is-valid');
          this.classList.add('is-invalid');
        }
      });
    });
  });
</script>
{% endblock %}